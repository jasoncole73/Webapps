<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Calculator Content</title>
<style>
    * { box-sizing: border-box; }
    body {
        margin: 0;
        padding: 15px; /* Add some padding around the calculator body */
        height: 100%; /* Full iframe height */
        background-color: #ece9d8; /* Standard XP window background */
        font-family: Tahoma, sans-serif;
        display: flex; /* Use flex to make calc-body fill space */
        flex-direction: column; /* Make calc-body stack its children vertically */
        overflow: hidden; /* Prevent scrollbars on body */
    }
    #calc-body { /* Calculator body will now fill the iframe */
        width: 100%;
        height: 100%;
        border: 1px solid #666;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        background-color: #d4d0c8; /* Calculator body color */
        padding: 15px; /* Padding inside the calculator body */
        display: flex;
        flex-direction: column;
        border-radius: 3px;
    }
    #calc-display {
        width: 100%;
        margin-bottom: 10px; /* Increased margin */
        padding: 10px 8px;   /* Increased padding */
        text-align: right;
        font-size: 32px;    /* Significantly larger display font */
        background-color: #E0F0E0;
        border: 2px inset #777; /* More prominent inset */
        box-sizing: border-box;
        flex-shrink: 0;
        height: 60px; /* Increased fixed height for display */
        font-family: 'Lucida Console', Monaco, monospace;
        border-radius: 3px;
        color: #222;
    }
     .calc-buttons {
         display: grid;
         grid-template-columns: repeat(4, 1fr);
         grid-template-rows: repeat(5, 1fr); /* Added for 5 rows of buttons */
         gap: 8px; /* Increased gap */
         flex-grow: 1; /* Buttons fill remaining space in #calc-body */
      }
     .calc-buttons button {
         font-size: 20px; /* Larger button font */
         cursor: pointer;
         background-color: #f0f0f0;
         border: 1px outset #bbb; /* Clearer button borders */
         height: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
         font-weight: bold;
         border-radius: 3px;
         color: #333;
         transition: background-color 0.1s;
      }
     .calc-buttons button:active {
         border-style: inset;
         background-color: #d0d0d0;
     }
     .calc-op { background-color: #d4e8f7; }
     .calc-eq { background-color: #f7e4d4; grid-column: span 4; /* Make equals full width */}
     .calc-c { background-color: #f7d4d4; }
     .calc-zero { grid-column: span 2; } /* Make zero button wider */
</style>
</head>
<body>
     <div id="calc-body">
         <input type="text" id="calc-display" readonly value="0">
         <div class="calc-buttons">
             <button onclick="calcClear()" class="calc-c">C</button>
             <button style="visibility: hidden;"></button> <!-- Placeholder for layout -->
             <button style="visibility: hidden;"></button> <!-- Placeholder for layout -->
             <button onclick="handleOperator('/')" class="calc-op">/</button>

             <button onclick="calcInput('7')">7</button>
             <button onclick="calcInput('8')">8</button>
             <button onclick="calcInput('9')">9</button>
             <button onclick="handleOperator('*')" class="calc-op">*</button>

             <button onclick="calcInput('4')">4</button>
             <button onclick="calcInput('5')">5</button>
             <button onclick="calcInput('6')">6</button>
             <button onclick="handleOperator('-')" class="calc-op">-</button>

             <button onclick="calcInput('1')">1</button>
             <button onclick="calcInput('2')">2</button>
             <button onclick="calcInput('3')">3</button>
             <button onclick="handleOperator('+')" class="calc-op">+</button>

             <button onclick="calcInput('0')" class="calc-zero">0</button>
             <button onclick="calcInput('.')">.</button>
             <button onclick="calcEquals()" class="calc-eq">=</button>
         </div>
    </div>

     <script>
        // Calculator JavaScript logic remains the same robust version from previous response.
        const calcDisplay = document.getElementById('calc-display');
        let currentCalcInput = '0';
        let previousInput = null;
        let operator = null;
        let shouldResetDisplay = false;

        function updateDisplay() { calcDisplay.value = currentCalcInput; }
        function calcClear() { currentCalcInput = '0'; previousInput = null; operator = null; shouldResetDisplay = false; updateDisplay(); }

        function calcInput(value) {
            if (shouldResetDisplay && !['+', '-', '*', '/'].includes(value)) {
                currentCalcInput = '0'; shouldResetDisplay = false;
            }
            if (value === '.') { if (!currentCalcInput.includes('.')) currentCalcInput += '.'; }
            else if (currentCalcInput === '0' && value !== '.') { currentCalcInput = value; }
            else { if (currentCalcInput.length < 15) currentCalcInput += value; }
            updateDisplay();
        }

        function handleOperator(nextOperator) {
            if (operator && previousInput !== null && !shouldResetDisplay) { calcEquals(); }
            previousInput = currentCalcInput;
            operator = nextOperator;
            shouldResetDisplay = true;
            console.log(`Operator: ${operator}, Previous: ${previousInput}`);
        }

        function calcEquals() {
            if (!operator || previousInput === null || shouldResetDisplay) { console.log("Equals pressed with no valid operation pending or after reset."); return; }
            let result; const prev = parseFloat(previousInput); const curr = parseFloat(currentCalcInput);
            if (isNaN(prev) || isNaN(curr)) { alert("Invalid input."); calcClear(); return; }
            switch(operator) {
                case '+': result = prev + curr; break; case '-': result = prev - curr; break;
                case '*': result = prev * curr; break;
                case '/': if (curr === 0) { alert("Cannot divide by zero!"); calcClear(); return; } result = prev / curr; break;
                default: console.error("Unknown operator:", operator); return;
            }
            currentCalcInput = String(parseFloat(result.toPrecision(12))).slice(0, 15);
            operator = null; previousInput = null; shouldResetDisplay = true;
            updateDisplay();
            console.log(`Equals: ${currentCalcInput}`);
        }

        calcClear(); // Initialize

        function cleanupGame() { console.log("[Calculator] cleanupGame called."); }
        window.addEventListener('message', (event) => { if (event.data === 'cleanup') cleanupGame(); });
        window.focus();
     </script>
</body>
</html>
