<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
    /* Styles specific to Memory Game */
    body { margin: 0; font-family: Tahoma, sans-serif; background-color: #ece9d8; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; height: 100%; padding-top: 10px; }
    .game-controls { padding: 5px; text-align: center; }
    .game-controls button { font-size: 12px; padding: 3px 10px; }
    .game-status { font-weight: bold; margin: 5px 0; min-height: 1.2em; font-size: 14px; }
    #memory-grid {
        display: grid;
        grid-template-columns: repeat(4, 80px); /* Adjust grid size as needed */
        gap: 10px;
        margin-top: 10px;
        perspective: 1000px; /* For 3D flip effect */
    }
    .memory-card {
        width: 80px; height: 80px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s;
        cursor: pointer;
        background-color: transparent;
    }
    .memory-card.flipped { transform: rotateY(180deg); }
    .memory-card.matched { cursor: default; opacity: 0.6; /* Indicate matched */}
    .card-face {
        position: absolute; width: 100%; height: 100%;
        backface-visibility: hidden; /* Hide back side when facing forward */
        display: flex; align-items: center; justify-content: center;
        border: 1px solid #999; border-radius: 5px; font-size: 40px;
    }
    .card-front { background-color: dodgerblue; color: white; /* Back of card */}
    .card-back { background-color: white; transform: rotateY(180deg); /* Face of card */}
</style>
</head>
<body>
    <div class="game-controls">
        <button id="memory-new-game">New Game</button>
        <div id="memory-status" class="game-status">Moves: 0</div>
    </div>
    <div id="memory-grid">
        <!-- Cards generated by JS -->
    </div>

    <script>
        const grid = document.getElementById('memory-grid');
        const statusDiv = document.getElementById('memory-status');
        const newGameButton = document.getElementById('memory-new-game');

        // More symbols = harder game (must be an even number)
        const symbols = ['ðŸŽ', 'ðŸŒ', 'ðŸ‡', 'ðŸ‰', 'ðŸ“', 'ðŸ’', 'ðŸ', 'ðŸ¥']; // 8 pairs = 16 cards
        let cards = [];
        let flippedCards = []; // Stores the 2 currently flipped cards
        let matchedPairs = 0;
        let moves = 0;
        let lockBoard = false; // Prevent clicking during checks/animations

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createMemoryBoard() {
            grid.innerHTML = '';
            matchedPairs = 0;
            moves = 0;
            flippedCards = [];
            lockBoard = false;
            updateStatus();

            const cardValues = shuffle([...symbols, ...symbols]); // Duplicate and shuffle

            // Adjust grid columns based on number of cards
            const numCards = cardValues.length;
            let cols = 4; // Default
            if (numCards === 16) cols = 4;
            else if (numCards === 20) cols = 5;
            else if (numCards === 12) cols = 4;
            grid.style.gridTemplateColumns = `repeat(${cols}, 80px)`;


            cardValues.forEach(value => {
                const card = document.createElement('div');
                card.classList.add('memory-card');
                card.dataset.value = value;
                card.innerHTML = `
                    <div class="card-face card-front">?</div>
                    <div class="card-face card-back">${value}</div>
                `;
                card.addEventListener('click', handleCardFlip);
                grid.appendChild(card);
            });
        }

        function handleCardFlip() {
            if (lockBoard || this.classList.contains('flipped') || this.classList.contains('matched')) return;

            this.classList.add('flipped');
            flippedCards.push(this);

            if (flippedCards.length === 2) {
                moves++;
                updateStatus();
                lockBoard = true; // Lock board while checking
                checkForMatch();
            }
        }

        function checkForMatch() {
            const [card1, card2] = flippedCards;
            const isMatch = card1.dataset.value === card2.dataset.value;

            if (isMatch) {
                disableCards();
            } else {
                unflipCards();
            }
        }

        function disableCards() {
            flippedCards.forEach(card => {
                card.classList.add('matched');
                // Optional: Remove click listener, but class check already prevents clicks
                // card.removeEventListener('click', handleCardFlip);
            });
            matchedPairs++;
            resetBoardState();
            checkWinCondition();
        }

        function unflipCards() {
            setTimeout(() => {
                flippedCards.forEach(card => card.classList.remove('flipped'));
                resetBoardState();
            }, 1000); // Wait 1 second before flipping back
        }

        function resetBoardState() {
            [flippedCards, lockBoard] = [[], false];
        }

        function updateStatus() {
            statusDiv.textContent = `Moves: ${moves}`;
        }

        function checkWinCondition() {
             if (matchedPairs === symbols.length) {
                 setTimeout(() => {
                     statusDiv.textContent = `You won in ${moves} moves!`;
                 }, 500); // Short delay before showing win message
             }
        }

        // --- Setup ---
        newGameButton.addEventListener('click', createMemoryBoard);
        createMemoryBoard(); // Start game on load

        // --- Cleanup Function ---
        function cleanupGame() { console.log("Cleaning up Memory Game"); /* No timers/intervals here */ }
    </script>
</body>
</html>