<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tic Tac Toe Content</title>
<style>
    * { box-sizing: border-box; }
    body {
        margin: 0; font-family: Tahoma, sans-serif; background-color: #ece9d8;
        display: flex; flex-direction: column; align-items: center;
        justify-content: center; /* Center content for better fit */
        height: 100%; overflow: hidden; padding: 10px; /* Add some padding */
    }
    .game-controls { padding-bottom: 10px; text-align: center; flex-shrink: 0; } /* Ensure it doesn't overflow */
    .game-controls button { font-size: 12px; padding: 3px 10px; }
    .game-status { font-weight: bold; margin-top: 5px; min-height: 1.2em; font-size: 14px;}
    #tic-tac-toe-board {
        display: grid;
        grid-template-columns: repeat(3, 80px);
        grid-template-rows: repeat(3, 80px);
        gap: 5px;
        background-color: #333;
        border: 5px solid #333;
        /* margin-top: 5px; -- Removed, body padding and flex center will handle spacing */
    }
    .ttt-cell {
        background-color: #fff; font-size: 50px; display: flex;
        align-items: center; justify-content: center; cursor: pointer;
        font-weight: bold; font-family: 'Arial Black', Gadget, sans-serif;
    }
    .ttt-cell:hover { background-color: #f0f0f0; }
    .ttt-cell.X { color: blue; } .ttt-cell.O { color: red; }
</style>
</head>
<body>
    <div class="game-controls">
        <button id="ttt-new-game">New Game</button>
        <div id="ttt-status" class="game-status">Your turn (X)</div>
    </div>
    <div id="tic-tac-toe-board">
        <!-- Cells generated by JS -->
    </div>

    <script>
        const boardDiv = document.getElementById('tic-tac-toe-board');
        const statusDiv = document.getElementById('ttt-status');
        const newGameButton = document.getElementById('ttt-new-game');
        let board = []; // Initialize as empty array
        let currentPlayer = 'X';
        let gameOver = false;

        function createBoard() {
            console.log("[TicTacToe] createBoard called");
            if (!boardDiv) {
                console.error("[TicTacToe] boardDiv element not found!");
                return;
            }
            boardDiv.innerHTML = ''; // Clear previous tiles
            board = ['', '', '', '', '', '', '', '', ''];
            currentPlayer = 'X';
            gameOver = false;
            statusDiv.textContent = "Your turn (X)";
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('ttt-cell');
                cell.dataset.index = i;
                cell.addEventListener('click', handleCellClick);
                boardDiv.appendChild(cell);
            }
            console.log("[TicTacToe] Board created with 9 cells.");
        }

        function handleCellClick(event) {
            if (gameOver || currentPlayer !== 'X') return;
            const index = parseInt(event.target.dataset.index);
            if (board[index] === '') {
                makeMove(index, 'X');
                if (!gameOver) {
                    currentPlayer = 'O';
                    statusDiv.textContent = "AI's turn (O)";
                    setTimeout(aiMove, 500);
                }
            }
        }

        function makeMove(index, player) {
            if (gameOver || board[index] !== '') return;
            board[index] = player;
            // Ensure boardDiv.children exists and has the child
            if (boardDiv.children[index]) {
                const cell = boardDiv.children[index];
                cell.textContent = player;
                cell.classList.add(player);
            } else {
                console.error(`[TicTacToe] Cell at index ${index} not found in boardDiv children.`);
            }


            if (checkWin(player)) {
                gameOver = true;
                statusDiv.textContent = `${player} wins!`;
                return;
            }
            if (board.every(cell => cell !== '')) {
                gameOver = true;
                statusDiv.textContent = "It's a draw!";
                return;
            }
        }
        function checkWin(player) { const wp = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]; return wp.some(p => p.every(i => board[i] === player)); }
        function aiMove() { if (gameOver) return; let ac = []; board.forEach((c, i) => { if (c === '') ac.push(i); }); if (ac.length > 0) { const ri = ac[Math.floor(Math.random() * ac.length)]; makeMove(ri, 'O'); if (!gameOver) { currentPlayer = 'X'; statusDiv.textContent = "Your turn (X)"; } } }

        function cleanupGame() { console.log("[TicTacToe] cleanupGame called."); }
        window.addEventListener('message', (event) => { if (event.data === 'cleanup') { cleanupGame(); } });

        newGameButton.addEventListener('click', createBoard);
        // Ensure DOM is ready for games that manipulate it immediately.
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', createBoard);
        } else {
            createBoard(); // DOM is already ready
        }
        console.log("[TicTacToe] Script loaded.");
    </script>
</body>
</html>
