<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Event Countdown – Flip Clock</title>

<!-- Flip/Tick core CSS -->
<link rel="stylesheet" href="https://unpkg.com/@pqina/flip/dist/flip.min.css">

<style>
  :root{
    /* Theme defaults */
    --flip-size: 9em;              /* default size */
    --tile-bg:   #3b3b3b;
    --tile-text: #ffffff;
    --label-text:#5a5d63;
    --inline-text:#5a5d63;
    --page-bg:   #ffffff;
    --tile-radius: 0em;            /* square tiles by default */
  }

  /* Hide library credit/watermark if present */
  .tick-credits{ display:none !important; }

  * { box-sizing: border-box; }
  body{
    margin:0;
    min-height:100vh;
    display:grid;
    grid-template-rows: auto 1fr auto; /* top badge, stage, bottom controls */
    background: var(--page-bg) !important;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  /* ===== Target badge (moved up & separated) ===== */
  .target-wrap{
    display:grid;
    place-items:center;
    padding: clamp(10px, 2vw, 18px) 1rem 0;
  }
  .target-badge{
    font: 600 clamp(.9rem, 2.2vw, 1.05rem)/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:#2f3131;
    background:#ffffff;
    border:1px solid rgba(0,0,0,.08);
    border-radius: 999px;
    padding: .55rem 1rem;
    box-shadow: 0 6px 22px rgba(0,0,0,.08);
    text-align:center;
    white-space: nowrap;
  }

  /* ===== Stage (fullscreenable) ===== */
  #stage{
    position: relative;
    display:grid;
    place-items:center;
    padding: clamp(8px, 2vw, 24px);
    gap:.75rem;
  }
  #fsBtn{
    position:absolute;
    top: clamp(8px, 2vw, 16px);
    right: clamp(8px, 2vw, 16px);
    z-index: 5;
    border: 1px solid rgba(0,0,0,.18);
    background: rgba(255,255,255,.85);
    backdrop-filter: blur(4px);
    border-radius: 10px;
    padding: .45rem .7rem;
    cursor: pointer;
    font-size: .9rem;
  }
  #stage.is-fullscreen{ padding-top: 8vh; } /* nudge clock down a bit in FS */

  /* ===== Flip styles wired to CSS vars ===== */
  .tick { font-size:1rem; white-space:nowrap; font-family:arial, sans-serif; }
  .tick-flip, .tick-text-inline { font-size: var(--flip-size); }
  .tick-label { margin-top:1em; font-size:1em; color: var(--label-text) !important; }
  .tick-char { width:1.5em; }
  .tick-text-inline { display:inline-block; text-align:center; min-width:1em; color: var(--inline-text) !important; }
  .tick-text-inline + .tick-text-inline { margin-left:-.325em; }
  .tick-group { margin:0 .5em; text-align:center; }
  .tick-flip { font-family: inherit !important; }
  .tick-flip-panel {
    background-color: var(--tile-bg) !important;
    color: var(--tile-text) !important;
    border-radius: var(--tile-radius) !important;
  }
  .tick-flip-panel-text-wrapper { line-height:1.45 !important; color: var(--tile-text) !important; }

  /* ===== Bottom controls (hidden automatically in fullscreen since not inside #stage) ===== */
  .bottom{
    display:grid;
    gap:1rem;
    padding: 1rem;
    justify-items:center;
  }
  .panel, details.panel{
    width:min(1100px,95vw);
    border:1px solid rgba(0,0,0,.06);
    border-radius:14px;
    background:#fff;
    box-shadow:0 6px 22px rgba(0,0,0,.08);
    padding:1rem;
  }
  .title{
    font: 600 clamp(1rem, 2.5vw, 1.25rem)/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:#3b3d3b;
    margin:0 0 .75rem;
  }
  .row{
    display:grid;
    grid-template-columns: repeat(6, minmax(0,1fr));
    gap:.75rem;
    align-items:center;
  }
  .controls{
    display:grid;
    grid-template-columns: repeat(6, minmax(0,1fr));
    gap:.75rem;
  }
  .controls label, .row label{
    display:grid;
    gap:.35rem;
    font-size:.9rem;
    color:#3b3d3b;
    align-content:start;
  }
  .controls input[type="color"],
  .controls input[type="number"],
  .controls input[type="range"],
  .row input[type="time"],
  .row input[type="date"],
  .row select{
    width:100%;
    height:38px;
    border:1px solid rgba(0,0,0,.15);
    border-radius:8px;
    padding:0 8px;
    background:#fafafa;
  }
  .btn{
    height:38px;
    border:1px solid rgba(0,0,0,.15);
    background:#f3f3f3;
    border-radius:8px;
    cursor:pointer;
  }

  /* Collapsible Appearance */
  details.panel summary{
    list-style:none;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:.5rem;
    font: 600 1rem/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:#3b3d3b;
    user-select:none;
  }
  details.panel summary::-webkit-details-marker{ display:none; }
  .chev{ inline-size: .8em; transform: rotate(0deg); transition: transform .2s ease; }
  details[open] .chev{ transform: rotate(90deg); }

  /* Responsive */
  @media (max-width: 900px){
    .controls, .row { grid-template-columns: repeat(3, minmax(0,1fr)); }
  }
  @media (max-width: 520px){
    .controls, .row { grid-template-columns: repeat(2, minmax(0,1fr)); }
    .tick { font-size:.85rem; }
  }
</style>
</head>
<body>

  <!-- Target date moved up & separated -->
  <div class="target-wrap">
    <div class="target-badge" id="targetBadge">Target: Christmas 2025 • 12:00 AM</div>
  </div>

  <!-- Fullscreen stage (only this goes fullscreen so controls disappear) -->
  <section id="stage" aria-label="Countdown stage">
    <button id="fsBtn" type="button" aria-label="Enter full screen">⤢ Full Screen</button>

    <div class="tick" data-did-init="handleTickInit">
      <div data-repeat="true" data-layout="horizontal fit" data-transform="preset(d, h, m, s) -> delay">
        <div class="tick-group">
          <div data-key="value" data-repeat="true" data-transform="pad(00) -> split -> delay">
            <span data-view="flip"></span>
          </div>
          <span data-key="label" data-view="text" class="tick-label"></span>
        </div>
      </div>
    </div>

    <div class="tick-onended-message" style="display:none">
      <p class="title" style="color:#3b3d3b;text-align:center">Time's up</p>
    </div>
  </section>

  <!-- Controls at the bottom -->
  <div class="bottom">
    <!-- Event panel -->
    <section class="panel">
      <h2 class="title">Event</h2>
      <div class="row">
        <label>Preset
          <select id="eventSelect">
            <option value="">— Select an event —</option>
            <option value="newyear">New Year’s Day</option>
            <option value="memorial">Memorial Day</option>
            <option value="labor">Labor Day</option>
            <option value="halloween">Halloween</option>
            <option value="thanksgiving">Thanksgiving</option>
            <option value="christmas" selected>Christmas</option>
          </select>
        </label>

        <label>Date (custom)
          <input type="date" id="customDate" value="2025-12-25" />
        </label>

        <label>Time (local)
          <input type="time" id="customTime" value="00:00" />
        </label>

        <button id="applyEventBtn" class="btn" type="button">Set Event</button>
      </div>
    </section>

    <!-- Appearance panel (collapsible; CLOSED by default) -->
    <details class="panel" id="appearancePanel">
      <summary><span class="chev">▶</span> Appearance</summary>
      <div style="margin-top:.75rem">
        <form class="controls" id="controls" onsubmit="return false;">
          <label>Tile background
            <input type="color" id="tileBg" value="#3b3b3b">
          </label>
          <label>Tile text
            <input type="color" id="tileText" value="#ffffff">
          </label>
          <label>Label text
            <input type="color" id="labelText" value="#5a5d63">
          </label>
          <label>Inline/separator text
            <input type="color" id="inlineText" value="#5a5d63">
          </label>
          <label>Page background
            <input type="color" id="pageBg" value="#ffffff">
          </label>
          <label>Size (em)
            <input type="number" id="sizeEm" value="9" step="0.25" min="2" max="24">
          </label>
          <label>Corner radius (em)
            <input type="range" id="radiusEm" value="0" step="0.02" min="0" max="0.6">
          </label>
          <button type="button" id="resetBtn" class="btn">Reset</button>
        </form>
      </div>
    </details>
  </div>

  <!-- Flip/Tick core JS -->
  <script src="https://unpkg.com/@pqina/flip/dist/flip.min.js"></script>

  <script>
    /* ========= Helpers: Holiday dates ========= */
    function nthWeekdayOfMonth(year, monthIndex, weekday, n){
      // weekday: 0=Sun..6=Sat, n: 1..5
      const first = new Date(year, monthIndex, 1);
      const offset = (7 + weekday - first.getDay()) % 7;
      const day = 1 + offset + (n-1)*7;
      return new Date(year, monthIndex, day);
    }
    function lastWeekdayOfMonth(year, monthIndex, weekday){
      const last = new Date(year, monthIndex + 1, 0); // last day of month
      const offset = (7 + last.getDay() - weekday) % 7;
      return new Date(year, monthIndex, last.getDate() - offset);
    }
    function getHolidayLocalDate(year, key){
      switch(key){
        case 'newyear':      return new Date(year, 0, 1);
        case 'memorial':     return lastWeekdayOfMonth(year, 4, 1);       // last Monday in May
        case 'labor':        return nthWeekdayOfMonth(year, 8, 1, 1);     // first Monday in Sept
        case 'halloween':    return new Date(year, 9, 31);
        case 'thanksgiving': return nthWeekdayOfMonth(year, 10, 4, 4);    // 4th Thursday in Nov
        case 'christmas':    return new Date(year, 11, 25);
        default: return null;
      }
    }
    function nextOccurrenceISO(key, timeStr="00:00"){
      if(!key) return null;
      const now = new Date();
      const [hh='00', mm='00'] = timeStr.split(':');
      const y = now.getFullYear();
      let d = getHolidayLocalDate(y, key);
      if (!d) return null;
      d.setHours(+hh, +mm, 0, 0);
      if (d <= now) {
        d = getHolidayLocalDate(y+1, key);
        d.setHours(+hh, +mm, 0, 0);
      }
      return d.toISOString();
    }
    function customISO(dateStr, timeStr="00:00"){
      if(!dateStr) return null;
      const [y,m,d] = dateStr.split('-').map(n=>+n);
      const [hh='00', mm='00'] = (timeStr||'00:00').split(':');
      const dt = new Date(y, m-1, d, +hh, +mm, 0, 0);
      return dt.toISOString();
    }
    function fmtLocal(dt){
      const opts = { year:'numeric', month:'long', day:'numeric', hour:'2-digit', minute:'2-digit' };
      return dt.toLocaleString([], opts);
    }

    /* ========= Countdown wiring ========= */
    let currentCounter = null; // keep a single active counter
    let tickInstance = null;

    function setTargetISO(iso){
      if(!iso || !tickInstance) return;
      // detach previous updates
      if (currentCounter) currentCounter.onupdate = function(){};
      // new counter
      currentCounter = Tick.count.down(iso);
      currentCounter.onupdate = v => { tickInstance.value = v; };
      currentCounter.onended  = () => {
        tickInstance.root.style.display = 'none';
        const msg = document.querySelector('.tick-onended-message');
        if (msg) msg.style.display = '';
      };

      // update top badge
      const when = new Date(iso);
      document.getElementById('targetBadge').textContent = 'Target: ' + fmtLocal(when);
      tickInstance.root.style.display = ''; // in case hidden previously
    }

    function handleTickInit(tick) {
      tickInstance = tick;

      // Default: Christmas 2025 @ 00:00 (local)
      const defaultISO = new Date(2025, 11, 25, 0, 0, 0, 0).toISOString();
      setTargetISO(defaultISO);

      // Reflect defaults in controls
      document.getElementById('eventSelect').value = 'christmas';
      document.getElementById('customDate').value = '2025-12-25';
      document.getElementById('customTime').value = '00:00';
    }

    /* ========= Appearance controls ========= */
    const rootStyle = document.documentElement.style;
    const qs = sel => document.querySelector(sel);

    const DEFAULTS = {
      tileBg:   '#3b3b3b',
      tileText: '#ffffff',
      labelText:'#5a5d63',
      inlineText:'#5a5d63',
      pageBg:   '#ffffff',
      sizeEm:   9,
      radiusEm: 0
    };

    function applyVars(vars){
      if ('tileBg' in vars)    rootStyle.setProperty('--tile-bg', vars.tileBg);
      if ('tileText' in vars)  rootStyle.setProperty('--tile-text', vars.tileText);
      if ('labelText' in vars) rootStyle.setProperty('--label-text', vars.labelText);
      if ('inlineText' in vars)rootStyle.setProperty('--inline-text', vars.inlineText);
      if ('pageBg' in vars)    rootStyle.setProperty('--page-bg', vars.pageBg);
      if ('sizeEm' in vars)    rootStyle.setProperty('--flip-size', vars.sizeEm + 'em');
      if ('radiusEm' in vars)  rootStyle.setProperty('--tile-radius', vars.radiusEm + 'em');
    }

    function initAppearance(){
      qs('#tileBg').value    = DEFAULTS.tileBg;
      qs('#tileText').value  = DEFAULTS.tileText;
      qs('#labelText').value = DEFAULTS.labelText;
      qs('#inlineText').value= DEFAULTS.inlineText;
      qs('#pageBg').value    = DEFAULTS.pageBg;
      qs('#sizeEm').value    = DEFAULTS.sizeEm;
      qs('#radiusEm').value  = DEFAULTS.radiusEm;
      applyVars(DEFAULTS);
    }

    function bindAppearance(){
      qs('#tileBg').addEventListener('input', e => applyVars({tileBg:e.target.value}));
      qs('#tileText').addEventListener('input', e => applyVars({tileText:e.target.value}));
      qs('#labelText').addEventListener('input', e => applyVars({labelText:e.target.value}));
      qs('#inlineText').addEventListener('input', e => applyVars({inlineText:e.target.value}));
      qs('#pageBg').addEventListener('input', e => applyVars({pageBg:e.target.value}));
      qs('#sizeEm').addEventListener('input', e => applyVars({sizeEm: parseFloat(e.target.value)||DEFAULTS.sizeEm}));
      qs('#radiusEm').addEventListener('input', e => applyVars({radiusEm: parseFloat(e.target.value)||DEFAULTS.radiusEm}));
      qs('#resetBtn').addEventListener('click', () => initAppearance());
    }

    /* ========= Event controls ========= */
    function bindEvents(){
      const select = qs('#eventSelect');
      const dateIn = qs('#customDate');
      const timeIn = qs('#customTime');
      const applyBtn = qs('#applyEventBtn');

      select.addEventListener('change', () => {
        if (!select.value) return;
        const iso = nextOccurrenceISO(select.value, timeIn.value || '00:00');
        setTargetISO(iso);
        dateIn.value = ''; // clear custom when preset chosen
      });

      applyBtn.addEventListener('click', () => {
        if (dateIn.value) {
          const iso = customISO(dateIn.value, timeIn.value || '00:00');
          setTargetISO(iso);
        } else if (select.value) {
          const iso = nextOccurrenceISO(select.value, timeIn.value || '00:00');
          setTargetISO(iso);
        }
      });
    }

    /* ========= Fullscreen ========= */
    (function(){
      const stage = document.getElementById('stage');
      const btn = document.getElementById('fsBtn');

      function updateFsBtn(){
        const fs = document.fullscreenElement === stage;
        stage.classList.toggle('is-fullscreen', fs);
        btn.textContent = fs ? '⤡ Exit Full Screen' : '⤢ Full Screen';
        btn.setAttribute('aria-label', fs ? 'Exit full screen' : 'Enter full screen');
      }
      async function toggleFullscreen(){
        try{
          if (document.fullscreenElement === stage) {
            await document.exitFullscreen();
          } else {
            await stage.requestFullscreen({ navigationUI: "hide" });
          }
        } catch(e){ /* ignore */ }
      }
      btn.addEventListener('click', toggleFullscreen);
      document.addEventListener('fullscreenchange', updateFsBtn);
      // keyboard: press "f" to toggle
      document.addEventListener('keydown', (e)=>{
        if (e.key.toLowerCase() === 'f') toggleFullscreen();
      });
      updateFsBtn();
    })();

    // Init controls
    initAppearance();
    bindAppearance();
    bindEvents();
  </script>
</body>
</html>
