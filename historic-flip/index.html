<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Historic Flip — Preset Count-Up</title>

  <!-- Flip (Tick) styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@pqina/flip/dist/flip.min.css" />

  <style>
    :root{
      --bg:#ffffff;
      --text:#0b3b17;
      --value:#5b2a77;
      --panel-bg:#ba7630;
      --radius:12px;
      --leading:1.4;
    }

    * { box-sizing: border-box; }
    html, body { height:100%; margin:0; }

    body {
      background:var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:#0f172a;
      display:grid;
      grid-template-rows:auto 1fr auto auto;
      gap:.25rem;
      transition:background .15s ease;
    }

    header{
      padding:.6rem clamp(1rem, 3vw, 2rem) 0;
    }
    header h1{
      margin:0;
      font-size:clamp(1rem, 1.2vw, 1.1rem);
      font-weight:600;
      color:#334155;
      opacity:.75;
    }

    .stage{
      display:grid;
      place-items:center;
      padding: .25rem clamp(.5rem, 3vw, 2rem) .25rem;
    }
    .title{
      text-align:center;
      font-size:clamp(1.2rem, 2.8vw, 1.7rem);
      margin:.1rem 0 .25rem;
      color:var(--text);
      min-height:1.6em;
    }

    .tick { white-space:nowrap; }
    .tick-flip, .tick-text-inline { font-size:7em; }
    .tick-group { margin:0 .35em; text-align:center; }
    .tick-label { margin-top:.7em; font-size:1em; color:var(--text) !important; }

    .tick-flip { border-radius:var(--radius) !important; }
    .tick-flip-panel { background-color:var(--panel-bg) !important; color:var(--value) !important; }
    .tick-flip-panel-text-wrapper { line-height:var(--leading) !important; }
    .tick-credits{ display:none !important; }

    .bar{
      max-width:1200px;
      margin:0 auto;
      width:100%;
      padding:0 clamp(1rem, 3vw, 2rem) .35rem;
    }

    .eventbar, .presetbar{
      display:flex;
      gap:.5rem;
      align-items:center;
      border:1px solid #e5e7eb;
      border-radius:14px;
      padding:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
      margin-bottom:.35rem;
    }

    .eventbar input[type="text"],
    .eventbar input[type="datetime-local"],
    .presetbar select{
      border:1px solid #dfe3e6;
      border-radius:10px;
      padding:.5rem .6rem;
      font-size:.95rem;
      background:#fff;
    }
    .eventbar .grow{ flex:1; }
    .eventbar .when{ flex:0 0 220px; }
    .presetbar .grow{ flex:1; }

    .btn{
      border:0; cursor:pointer;
      border-radius:10px; font-weight:600; font-size:.95rem;
      padding:.55rem .9rem;
    }
    .btn.primary{ background:#0f766e; color:#fff; }
    .btn.ghost{ background:#f1f5f9; color:#0f172a; }
    .btn.danger{ background:#ef4444; color:#fff; }

    details.panel{
      max-width:1200px;
      margin:.1rem auto 0;
      padding:0 clamp(1rem, 3vw, 2rem);
    }
    details.panel > summary{
      list-style:none;
      cursor:pointer;
      font-weight:600;
      color:#334155;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:.6rem .9rem;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
    }
    details.panel[open] > summary{ border-bottom-left-radius:0; border-bottom-right-radius:0; }
    .panel-body{
      border:1px solid #e5e7eb;
      border-top:0;
      border-bottom-left-radius:12px;
      border-bottom-right-radius:12px;
      background:#fff;
      padding:.8rem;
      display:flex; flex-wrap:wrap; gap:.75rem 1rem;
    }
    .chip{
      display:flex; align-items:center; gap:.5rem;
      border:1px solid #d1d5db;
      border-radius:999px;
      padding:.25rem .6rem;
      background:#fff;
    }
    .chip label{ font-size:.9rem; }
    .chip input[type="color"]{ width:36px; height:28px; border:1px solid #cbd5e1; border-radius:8px; }
    .chip select, .chip input[type="range"]{
      border:1px solid #cbd5e1; border-radius:8px; padding:.3rem .45rem;
      font-size:.9rem; background:#fff;
    }
    .chip input[type="range"]{ width:140px; }

    footer{
      text-align:center; color:#94a3b8; font-size:.85rem; padding:.25rem 0 1rem;
    }
  </style>
</head>
<body>
  <header><h1>Historic Flip — Preset Count-Up</h1></header>

  <!-- Clock -->
  <section class="stage">
    <div class="title" id="titleLine"></div>
    <div class="tick" data-did-init="handleTickInit">
      <div data-repeat="true" data-layout="horizontal fit" data-transform="preset(y, M, d, h, m, s) -> delay">
        <div class="tick-group">
          <div data-key="value" data-repeat="true" data-transform="pad(00) -> split -> delay">
            <span data-view="flip"></span>
          </div>
          <span data-key="label" data-view="text" class="tick-label"></span>
        </div>
      </div>
    </div>
  </section>

  <!-- Presets & Event Controls -->
  <div class="bar">
    <div class="presetbar">
      <select id="presetSelect" class="grow"></select>
      <button id="btnLoadPreset" class="btn ghost">Load preset</button>
      <button id="btnStartPreset" class="btn primary">Load & Start</button>
    </div>

    <div class="eventbar">
      <input id="eventName" class="grow" type="text" placeholder="Event name" />
      <input id="eventStart" class="when" type="datetime-local" />
      <button id="btnStart" class="btn primary">Start</button>
      <button id="btnSave" class="btn ghost">Save default</button>
      <button id="btnClear" class="btn danger">Clear</button>
    </div>
  </div>

  <!-- Style Panel -->
  <details class="panel">
    <summary>Style</summary>
    <div class="panel-body">
      <div class="chip"><label>Background</label><input id="bgColor" type="color" value="#ffffff"></div>
      <div class="chip"><label>Text</label><input id="textColor" type="color" value="#0b3b17"></div>
      <div class="chip"><label>Value</label><input id="valueColor" type="color" value="#5b2a77"></div>
      <div class="chip"><label>Font</label>
        <select id="fontFamily">
          <option value="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif">System UI</option>
          <option value="Arial, Helvetica, sans-serif">Arial</option>
          <option value="Georgia, serif">Georgia</option>
        </select>
      </div>
      <div class="chip"><label>Leading</label><input id="leading" type="range" min="1.0" max="2.0" step="0.05" value="1.4"></div>
      <div class="chip"><label>Panel</label><input id="panelBg" type="color" value="#ba7630"></div>
      <div class="chip"><label>Corner</label>
        <select id="cornerStyle">
          <option value="square">Square</option>
          <option value="soft" selected>Soft</option>
          <option value="round">Rounded</option>
        </select>
      </div>
      <div class="chip"><label>Radius</label><input id="cornerRadius" type="range" min="0" max="32" step="1" value="12"></div>
    </div>
  </details>

  <footer>Counting up from your chosen moment • Works offline on GitHub Pages</footer>

  <script src="https://cdn.jsdelivr.net/npm/@pqina/flip/dist/flip.min.js"></script>
  <script>
    const HISTORICAL_PRESETS = [
      { name: 'Elizabeth Birthday', at: '2004-03-09T00:00:00' },
      { name: 'Angi Birthday',      at: '1976-08-27T00:00:00' },
      { name: 'Jason Birthday',     at: '1973-11-18T00:00:00' },
      { name: 'Apollo 11 — First step on the Moon', at: '1969-07-21T02:56:15Z' },
      { name: 'Fall of the Berlin Wall', at: '1989-11-09T22:30:00+01:00' },
      { name: 'World Wide Web publicly available', at: '1991-08-06T00:00:00Z' },
      { name: 'Y2K — New Millennium', at: '2000-01-01T00:00:00' }
    ];

    const qs = id => document.getElementById(id);
    const LS_EVENT = 'historicFlipEvent';
    const LS_STYLE = 'historicFlipStyle';

    let tickInstance = null, counter = null;

    function safeStopCounter(){
      if (counter){ counter.onupdate = null; counter.stop(); counter = null; }
    }
    function startCounter(isoLocal){
      safeStopCounter();
      counter = Tick.count.up(isoLocal, { format: ['y','M','d','h','m','s'] });
      counter.onupdate = val => { if (tickInstance) tickInstance.value = val; };
    }

    function handleTickInit(tick){
      tickInstance = tick;
      populatePresets();
      bootEvent();
      bootStyle();
    }

    function populatePresets(){
      qs('presetSelect').innerHTML = HISTORICAL_PRESETS.map((p,i)=>`<option value="${i}">${p.name}</option>`).join('');
    }
    function applyPreset(index){
      const p = HISTORICAL_PRESETS[index];
      qs('eventName').value = p.name;
      qs('eventStart').value = p.at.slice(0,16);
    }

    qs('btnLoadPreset').onclick = () => applyPreset(qs('presetSelect').value);
    qs('btnStartPreset').onclick = () => { applyPreset(qs('presetSelect').value); startFromUI(); };

    function bootEvent(){
      const saved = JSON.parse(localStorage.getItem(LS_EVENT) || 'null');
      if (saved){ qs('eventName').value = saved.name; qs('eventStart').value = saved.isoLocal.slice(0,16); startCounter(saved.isoLocal); }
      else { applyPreset(0); startFromUI(); }
    }

    function startFromUI(){
      const name = qs('eventName').value;
      const iso = qs('eventStart').value + ':00';
      qs('titleLine').textContent = name;
      startCounter(iso);
      localStorage.setItem(LS_EVENT, JSON.stringify({name, isoLocal: iso}));
    }

    qs('btnStart').onclick = startFromUI;
    qs('btnSave').onclick = () => { startFromUI(); alert('Saved'); };
    qs('btnClear').onclick = () => { localStorage.removeItem(LS_EVENT); alert('Cleared'); };

    // Style handling
    const styleEls = { bg: qs('bgColor'), text: qs('textColor'), value: qs('valueColor'), font: qs('fontFamily'), leading: qs('leading'), panelBg: qs('panelBg'), cornerRadius: qs('cornerRadius') };
    function applyStyle(s){
      document.documentElement.style.setProperty('--bg', s.bg);
      document.documentElement.style.setProperty('--text', s.text);
      document.documentElement.style.setProperty('--value', s.value);
      document.documentElement.style.setProperty('--panel-bg', s.panelBg);
      document.documentElement.style.setProperty('--leading', s.leading);
      document.documentElement.style.setProperty('--radius', s.cornerRadius+'px');
      document.body.style.fontFamily = s.font;
    }
    function bootStyle(){
      const saved = JSON.parse(localStorage.getItem(LS_STYLE) || 'null') || { bg:'#ffffff', text:'#0b3b17', value:'#5b2a77', font:styleEls.font.value, leading:'1.4', panelBg:'#ba7630', cornerRadius:'12' };
      Object.keys(styleEls).forEach(k => styleEls[k].value = saved[k] || styleEls[k].value);
      applyStyle(saved);
    }
    Object.values(styleEls).forEach(el => el.oninput = () => { const s = Object.fromEntries(Object.entries(styleEls).map(([k,e])=>[k,e.value])); applyStyle(s); localStorage.setItem(LS_STYLE, JSON.stringify(s)); });
  </script>
</body>
</html>
