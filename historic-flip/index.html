<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Historic Flip — Preset Count‑Up (Responsive + Full‑Screen)</title>

  <!-- Flip (Tick) styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@pqina/flip/dist/flip.min.css" />

  <style>
    :root{
      /* Your default theme (matches current site) */
      --bg:#ffffff;
      --text:#356307;     /* green labels/title */
      --value:#ff2ba3;    /* pink digits */
      --panel-bg:#3d2811; /* dark brown panels */
      --radius:12px;
      --leading:1.4;

      /* Responsive sizing */
      --digit-min: 2.2rem;
      --digit-vw: 12vw;
      --digit-max: 7em;
      --title-min: 1.05rem;
      --title-vw: 2.4vw;
      --title-max: 1.6rem;
    }

    * { box-sizing: border-box; }
    html, body { height:100%; margin:0; }

    body {
      background:var(--bg);
      font-family: Arial, Helvetica, sans-serif;
      color:#0f172a;
      display:grid;
      grid-template-rows:auto 1fr auto auto; /* header, CLOCK, bars, footer */
      gap:.25rem;
      transition:background .15s ease;
      overflow-x:hidden;
    }

    header{
      padding:.6rem clamp(1rem, 3vw, 2rem) 0;
      display:flex; align-items:center; justify-content:space-between;
    }
    header h1{
      margin:0;
      font-size:clamp(1rem, 1.2vw, 1.1rem);
      font-weight:600;
      color:#334155;
      opacity:.75;
    }

    /* Full-screen toggle button (hidden while in fullscreen) */
    .fs-btn{
      border:0; cursor:pointer;
      border-radius:10px; font-weight:600; font-size:.95rem;
      padding:.5rem .8rem; background:#0f766e; color:#fff;
    }
    .fs-active .fs-btn{ display:none; }

    /* CLOCK FIRST */
    .stage{
      display:grid;
      place-items:center;
      padding: .25rem clamp(.5rem, 3vw, 2rem) .25rem;
    }
    .title{
      text-align:center;
      font-size:clamp(var(--title-min), var(--title-vw), var(--title-max));
      margin:.1rem 0 .25rem;
      color:var(--text);
      min-height:1.6em;
      line-height:1.15;
      word-break:break-word;
      padding:0 .25rem;
    }

    .tick { white-space:nowrap; max-width:100%; overflow:hidden; }
    .tick-flip, .tick-text-inline {
      font-size: clamp(var(--digit-min), var(--digit-vw), var(--digit-max));
    }
    .tick-group { margin:0 .35em; text-align:center; }
    .tick-label { margin-top:.7em; font-size:1em; color:var(--text) !important; }

    .tick-flip { border-radius:var(--radius) !important; }
    .tick-flip-panel { background-color:var(--panel-bg) !important; color:var(--value) !important; }
    .tick-flip-panel-text-wrapper { line-height:var(--leading) !important; }
    .tick-credits{ display:none !important; }

    /* Bars under the clock */
    .bar{
      max-width:1200px;
      margin:0 auto;
      width:100%;
      padding:0 clamp(1rem, 3vw, 2rem) .35rem;
    }

    .eventbar, .presetbar{
      display:flex; flex-wrap:wrap;
      gap:.5rem; align-items:center;
      border:1px solid #e5e7eb;
      border-radius:14px;
      padding:.5rem; background:#fff;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
      margin-bottom:.35rem;
    }

    .eventbar input[type="text"],
    .eventbar input[type="datetime-local"],
    .presetbar select{
      border:1px solid #dfe3e6; border-radius:10px;
      padding:.5rem .6rem; font-size:1rem; background:#fff; min-height:42px;
    }
    .eventbar .grow{ flex:1 1 280px; min-width:10rem; }
    .eventbar .when{ flex:0 1 220px; min-width:12rem; }
    .presetbar .grow{ flex:1 1 280px; min-width:10rem; }

    .btn{
      border:0; cursor:pointer;
      border-radius:10px; font-weight:600; font-size:1rem;
      padding:.55rem .9rem; white-space:nowrap; min-height:42px;
    }
    .btn.primary{ background:#0f766e; color:#fff; }
    .btn.ghost{ background:#f1f5f9; color:#0f172a; }
    .btn.danger{ background:#ef4444; color:#fff; }

    /* Style panel */
    details.panel{
      max-width:1200px; margin:.1rem auto 0;
      padding:0 clamp(1rem, 3vw, 2rem);
    }
    details.panel > summary{
      list-style:none; cursor:pointer; font-weight:600; color:#334155;
      background:#fff; border:1px solid #e5e7eb; border-radius:12px;
      padding:.6rem .9rem; box-shadow:0 1px 2px rgba(0,0,0,.04);
    }
    details.panel[open] > summary{ border-bottom-left-radius:0; border-bottom-right-radius:0; }
    .panel-body{
      border:1px solid #e5e7eb; border-top:0;
      border-bottom-left-radius:12px; border-bottom-right-radius:12px;
      background:#fff; padding:.8rem;
      display:flex; flex-wrap:wrap; gap:.75rem 1rem; align-items:center;
    }
    .chip{
      display:flex; align-items:center; gap:.5rem;
      border:1px solid #d1d5db; border-radius:999px;
      padding:.25rem .6rem; background:#fff; white-space:nowrap;
    }
    .chip label{ font-size:.95rem; }
    .chip input[type="color"]{ width:40px; height:32px; border:1px solid #cbd5e1; border-radius:8px; }
    .chip select, .chip input[type="range"]{
      border:1px solid #cbd5e1; border-radius:8px; padding:.35rem .5rem;
      font-size:.95rem; background:#fff; min-height:42px;
    }
    .chip input[type="range"]{ width:160px; }

    footer{ text-align:center; color:#94a3b8; font-size:.9rem; padding:.25rem 0 1rem; }

    /* ===== FULL-SCREEN: hide all controls ===== */
    .fs-active header,
    .fs-active .bar,
    .fs-active details.panel,
    .fs-active footer { display:none !important; }

    /* ===== Mobile niceties ===== */
    @media (max-width: 560px){
      .tick-group { margin: 0 .2em; }
      .tick-label { margin-top: .5em; font-size: .95em; }
      .eventbar .when { flex: 1 1 100%; min-width: unset; }
      .panel-body .chip { flex: 1 1 260px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Historic Flip — Preset Count‑Up</h1>
    <button class="fs-btn" id="fsToggle" type="button" title="Full Screen (F)">Full Screen</button>
  </header>

  <!-- CLOCK -->
  <section class="stage">
    <div class="title" id="titleLine"></div>
    <div class="tick" data-did-init="handleTickInit">
      <div data-repeat="true" data-layout="horizontal fit" data-transform="preset(y, M, d, h, m, s) -> delay">
        <div class="tick-group">
          <div data-key="value" data-repeat="true" data-transform="pad(00) -> split -> delay">
            <span data-view="flip"></span>
          </div>
          <span data-key="label" data-view="text" class="tick-label"></span>
        </div>
      </div>
    </div>
  </section>

  <!-- PRESETS + EVENT -->
  <div class="bar">
    <div class="presetbar">
      <select id="presetSelect" class="grow" title="Choose a historical event to load"></select>
      <button id="btnLoadPreset" class="btn ghost" title="Load selected preset into the event fields">Load preset</button>
      <button id="btnStartPreset" class="btn primary" title="Load and start">Load & Start</button>
    </div>

    <div class="eventbar">
      <input id="eventName" class="grow" type="text" placeholder="Event name" />
      <input id="eventStart" class="when" type="datetime-local" />
      <button id="btnStart" class="btn primary">Start</button>
      <button id="btnSave" class="btn ghost">Save default</button>
      <button id="btnClear" class="btn danger">Clear</button>
    </div>
  </div>

  <!-- Style Panel -->
  <details class="panel">
    <summary>Style</summary>
    <div class="panel-body">
      <div class="chip"><label>Background</label><input id="bgColor" type="color" value="#ffffff"></div>
      <div class="chip"><label>Text</label><input id="textColor" type="color" value="#356307"></div>
      <div class="chip"><label>Value</label><input id="valueColor" type="color" value="#ff2ba3"></div>
      <div class="chip"><label>Font</label>
        <select id="fontFamily">
          <option value="Arial, Helvetica, sans-serif" selected>Arial</option>
          <option value="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif">System UI</option>
          <option value="Georgia, serif">Georgia</option>
          <option value="'Courier New', monospace">Courier New</option>
          <option value="'Trebuchet MS', Arial, sans-serif">Trebuchet MS</option>
        </select>
      </div>
      <div class="chip"><label>Leading</label><input id="leading" type="range" min="1.0" max="2.0" step="0.05" value="1.4"></div>
      <div class="chip"><label>Panel</label><input id="panelBg" type="color" value="#3d2811"></div>
      <div class="chip"><label>Radius</label><input id="cornerRadius" type="range" min="0" max="32" step="1" value="12"></div>

      <!-- Reset Colors Button -->
      <div class="chip">
        <button id="resetColors" class="btn ghost" type="button" title="Restore default colors and styles">Reset Colors</button>
      </div>
    </div>
  </details>

  <footer>Counting up from your chosen moment • Works offline on GitHub Pages</footer>

  <script src="https://cdn.jsdelivr.net/npm/@pqina/flip/dist/flip.min.js"></script>
  <script>
    /* ======== Presets (includes your birthdays) ======== */
    const PRESETS = [
      { name: 'Elizabeth Birthday', at: '2004-03-09T00:00:00' },
      { name: 'Angi Birthday',      at: '1976-08-27T00:00:00' },
      { name: 'Jason Birthday',     at: '1973-11-18T00:00:00' },
      { name: 'Apollo 11 — First step on the Moon', at: '1969-07-21T02:56:15Z' },
      { name: 'Fall of the Berlin Wall',            at: '1989-11-09T22:30:00+01:00' },
      { name: 'World Wide Web publicly available',  at: '1991-08-06T00:00:00Z' },
      { name: 'Y2K — New Millennium',               at: '2000-01-01T00:00:00' }
    ];

    /* ======== Helpers ======== */
    const qs = id => document.getElementById(id);
    const LS_EVENT = 'historicFlipEvent';
    const LS_STYLE = 'historicFlipStyle';

    // Defaults used by Reset Colors
    const DEFAULT_STYLE = {
      bg:'#ffffff',
      text:'#356307',
      value:'#ff2ba3',
      font:'Arial, Helvetica, sans-serif',
      leading:'1.4',
      panelBg:'#3d2811',
      cornerRadius:'12'
    };

    function isoLocalFromInput(v){
      if (!v) return null;
      return v.length === 16 ? v + ':00' : v;
    }
    function setTitle(t){ qs('titleLine').textContent = t || ''; }

    /* ======== Tick lifecycle (prevents multi‑flip) ======== */
    let tickInstance = null;
    let counter = null;

    function stopCounter(){
      if (counter){
        try { counter.onupdate = null; counter.stop(); } catch(e){}
        counter = null;
      }
    }
    function startCounter(iso){
      stopCounter();
      counter = Tick.count.up(iso, { format: ['y','M','d','h','m','s'] });
      counter.onupdate = (value) => { if (tickInstance) tickInstance.value = value; };
    }

    /* ======== Init from Tick (must be global) ======== */
    function handleTickInit(tick){
      tickInstance = tick;

      // English labels for preset()
      const locale = {
        YEAR_PLURAL:'Years', YEAR_SINGULAR:'Year',
        MONTH_PLURAL:'Months', MONTH_SINGULAR:'Month',
        WEEK_PLURAL:'Weeks', WEEK_SINGULAR:'Week',
        DAY_PLURAL:'Days', DAY_SINGULAR:'Day',
        HOUR_PLURAL:'Hours', HOUR_SINGULAR:'Hour',
        MINUTE_PLURAL:'Minutes', MINUTE_SINGULAR:'Minute',
        SECOND_PLURAL:'Seconds', SECOND_SINGULAR:'Second',
        MILLISECOND_PLURAL:'Milliseconds', MILLISECOND_SINGULAR:'Millisecond'
      };
      for (const k in locale) tick.setConstant(k, locale[k]);

      populatePresets();
      bootEvent();
      bootStyle();
    }
    window.handleTickInit = handleTickInit;

    /* ======== Presets UI ======== */
    function populatePresets(){
      const sel = qs('presetSelect');
      sel.innerHTML = PRESETS.map((p, i) => `<option value="${i}">${p.name} — ${p.at}</option>`).join('');
    }
    function loadPresetToFields(index){
      const p = PRESETS[Number(index)];
      if (!p) return;
      const hasTZ = /([+-]\d{2}:\d{2}|Z)$/.test(p.at);
      qs('eventName').value = p.name;
      qs('eventStart').value = p.at.slice(0,16);
      qs('eventStart').dataset.tziso = hasTZ ? p.at : '';
    }
    qs('btnLoadPreset').addEventListener('click', () => {
      loadPresetToFields(qs('presetSelect').value);
    });
    qs('btnStartPreset').addEventListener('click', () => {
      loadPresetToFields(qs('presetSelect').value);
      startFromUI(true);
    });

    /* ======== Event state ======== */
    function bootEvent(){
      const saved = JSON.parse(localStorage.getItem(LS_EVENT) || 'null');
      if (saved && saved.name && saved.isoLocal){
        qs('eventName').value = saved.name;
        qs('eventStart').value = (saved.isoLocal || '').slice(0,16);
        qs('eventStart').dataset.tziso = '';
        setTitle(saved.name);
        startCounter(saved.isoLocal);
      } else {
        loadPresetToFields(0);
        startFromUI(true);
      }
    }

    function startFromUI(preferTZ=false){
      const name = (qs('eventName').value || 'Historic Event').trim();
      const tziso = qs('eventStart').dataset.tziso || '';
      const iso = (preferTZ && tziso) ? tziso : (isoLocalFromInput(qs('eventStart').value) || '2000-01-01T00:00:00');
      setTitle(name);
      startCounter(iso);
      localStorage.setItem(LS_EVENT, JSON.stringify({ name, isoLocal: iso }));
      const url = new URL(location.href);
      url.searchParams.set('event', name);
      url.searchParams.set('at', iso);
      history.replaceState({}, '', url.toString());
    }

    qs('btnStart').addEventListener('click', () => startFromUI(false));
    qs('btnSave').addEventListener('click', () => { startFromUI(false); });
    qs('btnClear').addEventListener('click', () => { localStorage.removeItem(LS_EVENT); });

    /* ======== Style ======== */
    const styleEls = {
      bg: document.getElementById('bgColor'),
      text: document.getElementById('textColor'),
      value: document.getElementById('valueColor'),
      font: document.getElementById('fontFamily'),
      leading: document.getElementById('leading'),
      panelBg: document.getElementById('panelBg'),
      cornerRadius: document.getElementById('cornerRadius')
    };

    function applyStyle(s){
      document.documentElement.style.setProperty('--bg', s.bg);
      document.documentElement.style.setProperty('--text', s.text);
      document.documentElement.style.setProperty('--value', s.value);
      document.documentElement.style.setProperty('--panel-bg', s.panelBg);
      document.documentElement.style.setProperty('--leading', s.leading);
      document.documentElement.style.setProperty('--radius', (s.cornerRadius||'12') + 'px');
      document.body.style.fontFamily = s.font;
    }

    function bootStyle(){
      const saved = JSON.parse(localStorage.getItem(LS_STYLE) || 'null') || DEFAULT_STYLE;
      styleEls.bg.value = saved.bg;
      styleEls.text.value = saved.text;
      styleEls.value.value = saved.value;
      styleEls.font.value = saved.font;
      styleEls.leading.value = saved.leading;
      styleEls.panelBg.value = saved.panelBg;
      styleEls.cornerRadius.value = saved.cornerRadius;
      applyStyle(saved);
    }

    function currentStyle(){
      return {
        bg: styleEls.bg.value,
        text: styleEls.text.value,
        value: styleEls.value.value,
        font: styleEls.font.value,
        leading: styleEls.leading.value,
        panelBg: styleEls.panelBg.value,
        cornerRadius: styleEls.cornerRadius.value
      };
    }

    Object.values(styleEls).forEach(el => {
      el.addEventListener('input', () => {
        const s = currentStyle();
        applyStyle(s);
        localStorage.setItem(LS_STYLE, JSON.stringify(s));
      });
    });

    // Reset Colors
    document.getElementById('resetColors').addEventListener('click', () => {
      styleEls.bg.value = DEFAULT_STYLE.bg;
      styleEls.text.value = DEFAULT_STYLE.text;
      styleEls.value.value = DEFAULT_STYLE.value;
      styleEls.font.value = DEFAULT_STYLE.font;
      styleEls.leading.value = DEFAULT_STYLE.leading;
      styleEls.panelBg.value = DEFAULT_STYLE.panelBg;
      styleEls.cornerRadius.value = DEFAULT_STYLE.cornerRadius;

      applyStyle(DEFAULT_STYLE);
      localStorage.setItem(LS_STYLE, JSON.stringify(DEFAULT_STYLE));
    });

    /* ======== Full‑Screen handling ======== */
    const fsToggle = document.getElementById('fsToggle');

    function enterFullscreen(){
      const el = document.documentElement;
      if (el.requestFullscreen) el.requestFullscreen();
      else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen(); // Safari
      else if (el.msRequestFullscreen) el.msRequestFullscreen();         // IE/Edge legacy
    }
    function exitFullscreen(){
      if (document.exitFullscreen) document.exitFullscreen();
      else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      else if (document.msExitFullscreen) document.msExitFullscreen();
    }
    function toggleFullscreen(){
      if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement){
        exitFullscreen();
      } else {
        enterFullscreen();
      }
    }
    fsToggle.addEventListener('click', toggleFullscreen);

    // Add/remove class to hide controls in fullscreen
    function syncFSClass(){
      const active = !!(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement);
      document.documentElement.classList.toggle('fs-active', active);
    }
    document.addEventListener('fullscreenchange', syncFSClass);
    document.addEventListener('webkitfullscreenchange', syncFSClass);
    document.addEventListener('msfullscreenchange', syncFSClass);

    // Keyboard shortcut: F to toggle fullscreen
    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'f') {
        e.preventDefault();
        toggleFullscreen();
      }
    });
  </script>
</body>
</html>
