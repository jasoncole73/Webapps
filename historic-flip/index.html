<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Historic Flip — Preset Count‑Up</title>

  <!-- Flip (Tick) styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@pqina/flip/dist/flip.min.css" />

  <style>
    :root{
      /* theme vars driven by the Style Controls */
      --bg:#ffffff;             /* page background */
      --text:#0b3b17;           /* title + labels */
      --value:#ff2ba3;          /* flip panel text color */
      --panel-bg:#3d2811;       /* flip panel background */
      --radius:0.12em;          /* card corner radius */
      --leading:1.4;            /* line-height inside panel */
      --accent:#356307;         /* label color (kept for legacy mapping) */
    }

    * { box-sizing: border-box; }
    html, body { height:100%; }

    body {
      margin:0;
      background: var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
      color:#222;
      display:grid;
      grid-template-rows:auto auto 1fr auto;
      gap:0.5rem;
      transition: background .15s ease;
    }

    header{
      padding:1rem clamp(1rem, 3vw, 2rem) 0.5rem;
      border-bottom:1px solid #eee;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }
    header h1{
      font-size:clamp(1.1rem, 1.8vw, 1.4rem);
      margin:0;
      font-weight:600;
      letter-spacing:.2px;
      color:#0f172a;
    }

    /* ----- Event controls ----- */
    .controls{
      width:100%;
      max-width:1100px;
      margin:0 auto;
      display:grid;
      gap:.75rem;
      grid-template-columns: 1fr;
      padding:0 clamp(1rem, 3vw, 2rem) .5rem;
    }
    .card{
      border:1px solid #e6e6e6;
      border-radius:16px;
      padding:1rem;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
      background:#fff;
    }
    .grid{
      display:grid;
      gap:.75rem;
    }
    @media (min-width:860px){
      .grid{
        grid-template-columns: 2fr 1.5fr auto;
        align-items:end;
      }
    }
    label{
      font-size:.9rem;
      color:#334155;
      display:block;
      margin:0 0 .35rem;
    }
    input[type="text"], input[type="datetime-local"]{
      width:100%;
      padding:.6rem .7rem;
      border:1px solid #dfe3e6;
      border-radius:10px;
      font-size:1rem;
      outline:none;
      background:#fff;
    }
    input[type="text"]:focus, input[type="datetime-local"]:focus{
      border-color:#94a3b8;
      box-shadow:0 0 0 3px rgba(148,163,184,.2);
    }
    .btnrow{ display:flex; gap:.5rem; flex-wrap:wrap; }
    button{
      appearance:none; border:0; cursor:pointer;
      padding:.65rem .9rem;
      border-radius:12px; font-weight:600; font-size:.95rem;
    }
    .primary{ background:#0f766e; color:#fff; }
    .ghost{ background:#f1f5f9; color:#0f172a; }
    .danger{ background:#ef4444; color:#fff; }

    /* ----- Style controls (demo-like) ----- */
    .style-bar{
      width:100%;
      max-width:1100px;
      margin:0 auto;
      padding:0 clamp(1rem, 3vw, 2rem);
      display:flex;
      flex-wrap:wrap;
      gap:1rem 1.25rem;
    }
    .group{
      display:flex; align-items:center; gap:0;
      border:2px solid #6b7280;
      border-radius:999px; padding:.25rem;
      background:#fff;
    }
    .group > label{
      margin:0; padding:.4rem .7rem; border-right:1px solid #d1d5db;
      color:#111827; font-size:.9rem; white-space:nowrap;
    }
    .group > label:last-of-type{ border-right:0; }
    .chip{
      display:flex; align-items:center; gap:.5rem;
      padding:.25rem .6rem;
      border-right:1px solid #d1d5db;
    }
    .chip:last-child{ border-right:0; }
    .chip input[type="color"]{
      width:36px; height:28px; border:1px solid #cbd5e1; border-radius:8px; background:#fff; padding:0;
    }
    .chip select, .chip input[type="text"], .chip input[type="range"], .chip input[type="number"]{
      border:1px solid #cbd5e1; border-radius:8px; padding:.35rem .5rem; font-size:.9rem; background:#fff;
    }
    .chip input[type="range"]{ width:140px; }

    /* ----- Counter area ----- */
    .stage{
      display:grid;
      place-items:center;
      padding: 0 clamp(1rem, 3vw, 2rem) 1rem; /* reduced bottom padding */
      margin-top: -.25rem; /* tighter to controls */
    }
    .title{
      text-align:center;
      font-size:clamp(1.25rem, 3vw, 1.75rem);
      margin:.25rem 0 1rem;
      color: var(--text);
      min-height:1.8em;
    }

    .tick {
      font-size: 1rem;
      white-space: nowrap;
    }

    /* fixed 7em size as requested */
    .tick-flip, .tick-text-inline {
      font-size: 7em;
    }

    .tick-label {
      margin-top: 1em;
      font-size: 1em;
      color: var(--text) !important;
    }

    .tick-char { width: 1.5em; }

    .tick-text-inline {
      display: inline-block;
      text-align: center;
      min-width: 1em;
      color: var(--text) !important;
    }

    .tick-text-inline + .tick-text-inline { margin-left: -0.325em; }
    .tick-group { margin: 0 .5em; text-align: center; }

    .tick-flip {
      border-radius: var(--radius) !important;
      /* font family is set on body; Flip inherits */
    }
    .tick-flip-panel {
      background-color: var(--panel-bg) !important;
      color: var(--value) !important;
    }
    .tick-flip-panel-text-wrapper {
      line-height: var(--leading) !important;
    }

    /* Remove Powered by PQINA */
    .tick-credits { display:none !important; }

    footer{
      text-align:center; color:#94a3b8; font-size:.85rem; padding:0 0 1.2rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Historic Flip — Preset Count‑Up</h1>
  </header>

  <!-- Event Controls -->
  <section class="controls">
    <div class="card">
      <div class="grid">
        <div>
          <label for="eventName">Event name</label>
          <input id="eventName" type="text" placeholder="e.g., Y2K — New Millennium" />
        </div>
        <div>
          <label for="eventStart">Start date &amp; time (your local time)</label>
          <input id="eventStart" type="datetime-local" />
        </div>
        <div class="btnrow">
          <button id="btnStart" class="primary" title="Start or update the counter">Start</button>
          <button id="btnSave" class="ghost" title="Save event as default for this browser">Save as default</button>
          <button id="btnClear" class="danger" title="Clear saved default">Clear</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Style Controls (demo-like) -->
  <section class="style-bar">
    <div class="group">
      <div class="chip">
        <label>Background Color</label>
        <input id="bgColor" type="color" value="#ffffff" />
      </div>
      <div class="chip">
        <label>Text Color</label>
        <input id="textColor" type="color" value="#0b3b17" />
      </div>
    </div>

    <div class="group">
      <div class="chip">
        <label>Value Color</label>
        <input id="valueColor" type="color" value="#ff2ba3" />
      </div>
      <div class="chip">
        <label>Font</label>
        <select id="fontFamily">
          <option value="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif">System UI</option>
          <option value="Arial, Helvetica, sans-serif">Arial</option>
          <option value="Roboto, Arial, sans-serif">Roboto (fallback)</option>
          <option value="Georgia, serif">Georgia</option>
          <option value="'Courier New', monospace">Courier New</option>
          <option value="'Trebuchet MS', Arial, sans-serif">Trebuchet MS</option>
        </select>
      </div>
      <div class="chip">
        <label>Leading</label>
        <input id="leading" type="range" min="1.0" max="2.0" step="0.05" value="1.4" />
      </div>
    </div>

    <div class="group">
      <div class="chip">
        <label>Panel Color</label>
        <input id="panelBg" type="color" value="#3d2811" />
      </div>
      <div class="chip">
        <label>Corner Style</label>
        <select id="cornerStyle">
          <option value="square">Square</option>
          <option value="soft" selected>Soft</option>
          <option value="round">Rounded</option>
          <option value="xround">Extra‑round</option>
        </select>
      </div>
      <div class="chip">
        <label>Corner Radius</label>
        <input id="cornerRadius" type="range" min="0" max="32" step="1" value="2" />
      </div>
    </div>
  </section>

  <!-- Counter -->
  <section class="stage">
    <div class="title" id="titleLine"></div>

    <div class="tick" data-did-init="handleTickInit">
      <div data-repeat="true" data-layout="horizontal fit" data-transform="preset(y, M, d, h, m, s) -> delay">
        <div class="tick-group">
          <div data-key="value" data-repeat="true" data-transform="pad(00) -> split -> delay">
            <span data-view="flip"></span>
          </div>
          <span data-key="label" data-view="text" class="tick-label"></span>
        </div>
      </div>
    </div>
  </section>

  <footer>
    Counting up from your chosen moment • Works offline on GitHub Pages
  </footer>

  <!-- Flip (Tick) script -->
  <script src="https://cdn.jsdelivr.net/npm/@pqina/flip/dist/flip.min.js"></script>

  <script>
    /* ---------- Helpers ---------- */
    const qs = id => document.getElementById(id);

    function localDateTimeToIsoLocal(dtValue){
      if(!dtValue) return null;               // "2000-01-01T00:00"
      return dtValue + ":00";                 // keep local (no timezone suffix)
    }
    function setTitle(name){ qs('titleLine').textContent = name || ''; }
    function parseQuery(){
      const p = new URLSearchParams(window.location.search);
      return { event: p.get('event') || '', at: p.get('at') || '' };
    }

    /* ---------- Tick setup ---------- */
    let tickInstance = null;
    function handleTickInit(tick) {
      tickInstance = tick;

      const locale = {
        YEAR_PLURAL: 'Years', YEAR_SINGULAR: 'Year',
        MONTH_PLURAL: 'Months', MONTH_SINGULAR: 'Month',
        WEEK_PLURAL: 'Weeks', WEEK_SINGULAR: 'Week',
        DAY_PLURAL: 'Days', DAY_SINGULAR: 'Day',
        HOUR_PLURAL: 'Hours', HOUR_SINGULAR: 'Hour',
        MINUTE_PLURAL: 'Minutes', MINUTE_SINGULAR: 'Minute',
        SECOND_PLURAL: 'Seconds', SECOND_SINGULAR: 'Second',
        MILLISECOND_PLURAL: 'Milliseconds', MILLISECOND_SINGULAR: 'Millisecond'
      };
      for (const key in locale) tick.setConstant(key, locale[key]);

      bootFromQueryOrStorage();
      bootStyleFromStorage();
    }

    function startCounter(isoLocal){
      if (window._historicFlipCounter && typeof window._historicFlipCounter.stop === 'function') {
        try { window._historicFlipCounter.stop(); } catch(e){}
      }
      window._historicFlipCounter = Tick.count.up(isoLocal, { format: ['y','M','d','h','m','s'] });
      window._historicFlipCounter.onupdate = v => { if (tickInstance) tickInstance.value = v; };
    }

    /* ---------- Event state ---------- */
    const LS_EVENT = 'historicFlipEvent';
    function bootFromQueryOrStorage(){
      const q = parseQuery();
      let name='', isoLocal='';

      if (q.at){
        name = q.event || 'Historic Event';
        isoLocal = q.at;
      } else {
        const saved = JSON.parse(localStorage.getItem(LS_EVENT) || 'null');
        if (saved?.name && saved?.isoLocal){
          name = saved.name;
          isoLocal = saved.isoLocal;
        } else {
          name = 'Y2K — New Millennium';
          isoLocal = '2000-01-01T00:00:00';
        }
      }
      setTitle(name);
      startCounter(isoLocal);
      qs('eventName').value = name;
      qs('eventStart').value = (isoLocal || '').slice(0,16);
    }

    qs('btnStart').addEventListener('click', () => {
      const name = (qs('eventName').value || 'Historic Event').trim();
      const isoLocal = localDateTimeToIsoLocal(qs('eventStart').value) || '2000-01-01T00:00:00';
      setTitle(name);
      startCounter(isoLocal);
      const url = new URL(window.location.href);
      url.searchParams.set('event', name);
      url.searchParams.set('at', isoLocal);
      history.replaceState({}, '', url.toString());
    });

    qs('btnSave').addEventListener('click', () => {
      const name = (qs('eventName').value || 'Historic Event').trim();
      const isoLocal = localDateTimeToIsoLocal(qs('eventStart').value) || '2000-01-01T00:00:00';
      localStorage.setItem(LS_EVENT, JSON.stringify({name, isoLocal}));
      qs('btnSave').textContent = 'Saved ✓';
      setTimeout(()=> qs('btnSave').textContent = 'Save as default', 1200);
    });

    qs('btnClear').addEventListener('click', () => {
      localStorage.removeItem(LS_EVENT);
      qs('btnClear').textContent = 'Cleared ✓';
      setTimeout(()=> qs('btnClear').textContent = 'Clear', 1200);
    });

    /* ---------- Style controls ---------- */
    const LS_STYLE = 'historicFlipStyle';
    const styleEls = {
      bg: qs('bgColor'),
      text: qs('textColor'),
      value: qs('valueColor'),
      font: qs('fontFamily'),
      leading: qs('leading'),
      panelBg: qs('panelBg'),
      cornerStyle: qs('cornerStyle'),
      cornerRadius: qs('cornerRadius')
    };

    function applyStyle(style){
      if (style.bg) document.documentElement.style.setProperty('--bg', style.bg);
      if (style.text) {
        document.documentElement.style.setProperty('--text', style.text);
        document.documentElement.style.setProperty('--accent', style.text);
      }
      if (style.value) document.documentElement.style.setProperty('--value', style.value);
      if (style.panelBg) document.documentElement.style.setProperty('--panel-bg', style.panelBg);
      if (style.leading) document.documentElement.style.setProperty('--leading', style.leading);
      if (style.font) document.body.style.fontFamily = style.font;

      // Corner style presets mapped to radius (em)
      const presetRadius = {
        square: 0,
        soft: 0.12 * 16,   // will be converted to px below
        round: 8,
        xround: 16
      };
      let r = style.cornerRadius != null ? Number(style.cornerRadius) : presetRadius.soft;
      if (style.cornerStyle && presetRadius[style.cornerStyle] != null && style.cornerRadius == null){
        r = presetRadius[style.cornerStyle];
      }
      // Apply px radius; Flip cards size in em, but CSS allows px too
      document.documentElement.style.setProperty('--radius', r + 'px');
    }

    function currentStyleFromUI(){
      return {
        bg: styleEls.bg.value,
        text: styleEls.text.value,
        value: styleEls.value.value,
        font: styleEls.font.value,
        leading: styleEls.leading.value,
        panelBg: styleEls.panelBg.value,
        cornerStyle: styleEls.cornerStyle.value,
        cornerRadius: styleEls.cornerRadius.value
      };
    }

    function setUIFromStyle(style){
      if (style.bg) styleEls.bg.value = style.bg;
      if (style.text) styleEls.text.value = style.text;
      if (style.value) styleEls.value.value = style.value;
      if (style.font) styleEls.font.value = style.font;
      if (style.leading) styleEls.leading.value = style.leading;
      if (style.panelBg) styleEls.panelBg.value = style.panelBg;
      if (style.cornerStyle) styleEls.cornerStyle.value = style.cornerStyle;
      if (style.cornerRadius != null) styleEls.cornerRadius.value = style.cornerRadius;
    }

    function saveStyle(style){
      localStorage.setItem(LS_STYLE, JSON.stringify(style));
    }

    function bootStyleFromStorage(){
      const saved = JSON.parse(localStorage.getItem(LS_STYLE) || 'null') || {
        bg:'#ffffff',
        text:'#0b3b17',
        value:'#ff2ba3',
        font:"system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif",
        leading:'1.4',
        panelBg:'#3d2811',
        cornerStyle:'soft',
        cornerRadius:'2'
      };
      setUIFromStyle(saved);
      applyStyle(saved);
    }

    // Wire up live updates
    Object.values(styleEls).forEach(el => {
      el.addEventListener('input', () => {
        const style = currentStyleFromUI();
        // If user changes style preset, clear radius unless user also drags slider
        if (el === styleEls.cornerStyle) style.cornerRadius = null;
        applyStyle(style);
        saveStyle(style);
      });
      el.addEventListener('change', () => {
        const style = currentStyleFromUI();
        applyStyle(style);
        saveStyle(style);
      });
    });
  </script>
</body>
</html>
